
  CREATE OR REPLACE  VIEW HV_PRICE_CHECK (SECURITY, STK_SEC_ID, AMT, TICKER, NSE_CODE, NSE_CLOSE, BSE_CLOSE, NAV_DATE, S_STK_ID) AS 
  SELECT SCHNAVBD.SECURITY,
SECURITY.STK_SEC_ID,
-SUM(SCHNAVBD.AMOUNT)/SUM(SCHNAVBD.UNITS) AMT,
SECURITY.TICKER,
NSE.SYMBOL AS NSE_CODE,
NSE.CLOSE AS NSE_CLOSE,
BSE.CLOSE AS BSE_CLOSE,
SCHNAVBD.NAV_DATE,
substr(SECURITY.STK_SEC_ID,3,(length(SECURITY.STK_SEC_ID)-2)) S_STK_ID
FROM HI_SCHNAVBD_CURR SCHNAVBD,
HM_SECURITY SECURITY,
HTMP_BSE_EXT BSE,
HTMP_NSE_EXT NSE
WHERE TRIM(NSE.SYMBOL) = substr(SECURITY.STK_SEC_ID,3,(length(SECURITY.STK_SEC_ID)-2)) --SCHNAVBD.SECURITY
--AND NSE.UPD_DT = SCHNAVBD.NAV_DATE
AND TRIM(BSE.SC_CODE) = SECURITY.TICKER
--AND BSE.UPD_DT = SCHNAVBD.NAV_DATE
AND SCHNAVBD.SECURITY = SECURITY.SECURITY
AND (
/*(SCHNAVBD.NAV_DATE =
(SELECT CUR_DATE-1 FROM SYSPARAM WHERE RECTYPE='L'
))
AND*/
(SCHNAVBD.INVEST_TYPE ='INVEST')
AND (SCHNAVBD.UNITS <>'0')
AND (SECURITY.ASSET_TYPE ='01')
AND (SECURITY.SECURITY <>SECURITY.STK_SEC_ID)
AND (SCHNAVBD.SCHEME NOT IN ('HDFCSX','HDFCS+','HDFCNY'))
AND (SECURITY.RECTYPE ='L') )
AND SECURITY.SECURITY <>'ARSSINF'
and NSE.SERIES = 'EQ'
GROUP BY SCHNAVBD.SECURITY,
SECURITY.STK_SEC_ID,
SECURITY.TICKER,
BSE.SC_CODE,
NSE.SYMBOL,
NSE.CLOSE,
BSE.CLOSE,
SCHNAVBD.NAV_DATE
ORDER BY 1,
2;
 
