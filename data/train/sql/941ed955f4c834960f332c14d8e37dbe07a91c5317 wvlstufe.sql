UPDATE BEWERBUNGEN
SET WVLSTUFE = CAST(ROUND((JULIANDAY(WVL) - JULIANDAY(DATUM)) / 28) AS INT) - 1
WHERE JULIANDAY(WVL) - JULIANDAY(DATUM)  >= 28 AND BISDATUM IS NULL;

UPDATE BEWERBUNGEN
SET WVLSTUFE = CAST(ROUND((JULIANDAY(WVL) - JULIANDAY(BISDATUM)) / 28) AS INT) - 1
WHERE JULIANDAY(WVL) - JULIANDAY(BISDATUM)  >= 28 AND NOT BISDATUM IS NULL;

DROP TRIGGER UPDATE_WVL_STUFE;

CREATE TRIGGER UPDATE_WVL_STUFE UPDATE OF WVL ON BEWERBUNGEN
BEGIN 
UPDATE BEWERBUNGEN
SET WVLSTUFE = CAST(ROUND((JULIANDAY(NEW.WVL) - JULIANDAY(NEW.DATUM)) / 28) AS INT) - 1
WHERE JULIANDAY(NEW.WVL) - JULIANDAY(NEW.DATUM)  >= 28 AND NEW.BISDATUM IS NULL;

UPDATE BEWERBUNGEN
SET WVLSTUFE = CAST(ROUND((JULIANDAY(NEW.WVL) - JULIANDAY(NEW.BISDATUM)) / 28) AS INT) - 1
WHERE JULIANDAY(NEW.WVL) - JULIANDAY(NEW.BISDATUM)  >= 28 AND NOT NEW.BISDATUM IS NULL;
END;
