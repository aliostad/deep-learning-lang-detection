#include "Engine.h"
#include "utils.h"
#include "model/Model.h"

#include <iostream>
#include <cassert>
#include <vector>


SanityCheckedModel * initializeModel() {
  UncheckedModel * uncheckedModel = UncheckedModel::newUncheckedModel();

  // Setup the map
  Coord mapSize(24, 80);
  const char * mapSource[] = {
    "################################################################################",
    "#...................#..........................................................#",
    "#...................#..........................................................#",
    "#...................#..........................................................#",
    "#...................#..........................................................#",
    "#...................#..........................................................#",
    "#...................#..........................................................#",
    "#...................#######....................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#.........................#########............................................#",
    "#.................................#............................................#",
    "#.........................#.......#............................................#",
    "#.........................#.......#............................................#",
    "#.........................#########............................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "#..............................................................................#",
    "################################################################################"
  };
  Map * map = Map::newMap(mapSize, mapSource);
  uncheckedModel->setMap(map);

  // Add player
  uncheckedModel->addUnit(Player::newPlayer(), Coord(15, 15));

  SanityCheckedModel * checkedModel = SanityCheckedModel::newCheckedModel(uncheckedModel);

  return checkedModel;
}

int main() {
  GameUI * ui = GameUI::createTerminalGameUI();

  SanityCheckedModel * model = initializeModel();

  Engine engine(ui, model);

  // Start the game
  engine.run();
}
