/* Formatted on 8/23/2012 1:58:39 PM (QP5 v5.215.12089.38647) */
CREATE TABLE PROTECT.POLICY_LOG
AS
   SELECT *
     FROM PROTECT.POLICY
    WHERE 1 = 2;

ALTER TABLE PROTECT.POLICY_LOG ADD (LOGTIME TIMESTAMP(6));

CREATE OR REPLACE TRIGGER PROTECT.POLICY_UPDATE
   AFTER UPDATE OF VERSION, NAME, DESCRIPTION, ACTIVESTATUS, ISDELETED, ROOTCONDITIONID, POLICYGROUPID
   ON PROTECT.POLICY
   REFERENCING NEW AS NEW OLD AS OLD
   FOR EACH ROW
DECLARE
BEGIN
   INSERT INTO PROTECT.POLICY_LOG
      (SELECT :NEW.POLICYID,
              :NEW.VERSION,
              :NEW.NAME,
              :NEW.DESCRIPTION,
              :NEW.CREATEUSERID,
              :NEW.EDITUSERID,
              :NEW.ACTIVESTATUS,
              :NEW.CREATEDATE,
              :NEW.EDITDATE,
              :NEW.ISDELETED,
              :NEW.ROOTCONDITIONID,
              :NEW.POLICYGROUPID,
              CURRENT_TIMESTAMP
         FROM DUAL);
EXCEPTION
   WHEN OTHERS
   THEN
      NULL;
END POLICY_UPDATE;