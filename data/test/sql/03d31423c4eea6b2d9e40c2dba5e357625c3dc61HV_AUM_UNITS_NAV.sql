
  CREATE OR REPLACE  VIEW HV_AUM_UNITS_NAV (SCHEME, LOAD, TER, EXPENSE_RATE, GR, NET_ASSETS, LAST_NET_ASSETS, LNA, NAV, LAST_NAV, LAST_UNITS_OUTS, WKNAV_SCHEME, SCHCLASS, WEEKEND_DT, BOOK_DATE, SCHEME_NAME, NAME, APPRE_DEPRE, PREV_DATE, ACCENT_SCHEME, LEVEL_1, LEVEL_2, ACNT_UNIT, BUY_NAV_VALUE, SELL_NAV_VALUE, PORTFOLIO_TYPE, PORTFOLIO_CATEGORY) AS 
  SELECT DISTINCT (B.SCHEME),
    NVL(B.FF_N1,0) LOAD,
    NVL(B.FF_N2,0) TER,
    B.FF_N3 EXPENSE_RATE,
    C.FF_VC1 GR,
    (A.NET_ASSETS_F) NET_ASSETS,
    (A.LAST_NET_ASSETS) LAST_NET_ASSETS,
    --(A.LAST_NAV * ACCENTV.ACNT_UNIT) LNA, COMENETED TO PICK LAST DAY NAV
    (ACCENTV.EXCH_RATE * ACCENTV.ACNT_UNIT) LNA,
    (
    CASE
      WHEN ACCENTV.ACNT_UNIT > 10
        --  THEN ROUND(A.LAST_NET_ASSETS/ACCENTV.ACNT_UNIT,5)Temperory test to get last days nav
      THEN ROUND(ACCENTV.EXCH_RATE,8)
      ELSE TO_NUMBER(10)
    END) NAV,
    (A.LAST_NAV) LAST_NAV,
    (A.LAST_UNITS_OUTS) LAST_UNITS_OUTS,
    A.SCHEME WKNAV_SCHEME,
    A.SCHCLASS SCHCLASS,
    A.WEEKEND_DT,
    ACCENTV.BOOK_DATE,
    B.SCHEME_NAME ,
    C.NAME,
    APPRE_DEPRE,
    -- (SYSPARAM.CUR_DATE-1) PREV_DATE,--commented for testing
    NULL AS PREV_DATE,
    ACCENTV.SCHEME ACCENT_SCHEME,
    ACCENTV.LEVEL_1,
    ACCENTV.LEVEL_2,
    ACCENTV.ACNT_UNIT,
    a.last_nav*(1-b.pur_load)                   AS buy_nav_value,
    a.last_nav*(1+b.sale_load)                  AS sell_nav_value,
    DECODE(b.scheme_type, 'O', 'OPEN', 'CLOSE') AS portfolio_type,
    B.port_type                                 AS portfolio_category
  FROM --SYSPARAM,   --commented for testing
    HI_WEEKNAV_CURR A,
    HM_SCHEME B ,
    HM_SCHCLASS C,
    (SELECT ACCENT.SCHEME,
      ACCENT.EXCH_RATE,
      ACCENT.LEVEL_1,
      ACCENT.LEVEL_2,
      ACCENT.BOOK_DATE,
      SUM(ACCENT.AMOUNT) ACNT_UNIT
      --(SUM(ACCENT.AMOUNT)/SCHEME.FACE_VALUE) ACNT_UNIT --COMMENTED FOR TESTING
    FROM HI_ACCENT_LIVE ACCENT, -- HI_ACCENT_CURR ACCENT, COMMMENTED FOR TESTING
      HM_SCHEME SCHEME
    WHERE ACCENT.SCHEME = SCHEME.SCHEME
      -- AND ACCENT.BOOK_DATE < = '26 Nov 2013' ---inserted for testing
    AND ACCENT.LEVEL_1 = '310100'
    AND SCHEME.RECTYPE = 'L'
    AND SCHEME.SCHEME IN
      (SELECT SCHEME
      FROM HM_SCHEME
      WHERE RECTYPE   = 'L'
      AND NXT_NAV_DT  < '31 MAR 2014'
      AND ACTIVATE_Y_N='Y'
      )
    GROUP BY ACCENT.SCHEME,
      ACCENT.EXCH_RATE,
      ACCENT.LEVEL_1,
      ACCENT.LEVEL_2,
      SCHEME.FACE_VALUE ,
      ACCENT.BOOK_DATE
    ) ACCENTV
  WHERE A.SCHCLASS   <> 'GLOBAL'
  AND A.SCHCLASS      = C.SCHCLASS
  AND A.SCHEME        = C.SCHEME
  AND A.AMC_CODE      = C.AMC_CODE
  AND C.RECTYPE       ='L'
  AND ACCENTV.SCHEME  = A.SCHEME
  AND ACCENTV.LEVEL_2 = A.SCHCLASS
  AND A.SCHEME        = B.SCHEME
  AND C.FF_VC1       IS NULL
    -- and a.scheme ='HDFCLI'
  AND B.ACTIVATE_Y_N = 'Y'
  AND B.RECTYPE      = 'L'
  -- AND (SYSPARAM.RECTYPE='L')
  --AND (A.WEEKEND_DT    = '25 Nov 2013')--SYSPARAM.CUR_DATE-1) commented for testing commented by gaurav
  UNION ALL
  SELECT DISTINCT (B.SCHEME),
    NVL(B.FF_N1,0) LOAD,
    NVL(B.FF_N2,0) TER,
    --B.FF_N2 EXPENSE_RATE,COmment by gaurav as expense rate coming wrong 
    B.FF_N3 EXPENSE_RATE,
    C.FF_VC1 GR,
    (A.NET_ASSETS_F) NET_ASSETS,
    (A.LAST_NET_ASSETS) LAST_NET_ASSETS,
    -- (A.LAST_NAV * ACCENTV.ACNT_UNIT) LNA,
    -- (A.LAST_NAV * ACCENTV.ACNT_UNIT)  LNA,  --GROUP LNA taking the previous day nav
    (ACCENTV.EXCH_RATE * ACCENTV.ACNT_UNIT) LNA,
    (
    CASE
      WHEN ACCENTV.ACNT_UNIT > 10
      THEN ROUND(GROUP_NAV,8)
      ELSE TO_NUMBER(10)
    END) NAV, ----GROUP nav
    (A.LAST_NAV) LAST_NAV,
    (A.LAST_UNITS_OUTS) LAST_UNITS_OUTS,
    A.SCHEME WKNAV_SCHEME,
    A.SCHCLASS SCHCLASS,
    A.WEEKEND_DT,
    ACCENTV.BOOK_DATE,
    B.SCHEME_NAME ,
    C.NAME,
    APPRE_DEPRE,
    -- (SYSPARAM.CUR_DATE-1) PREV_DATE,--commented for testing
    NULL AS PREV_DATE,
    ACCENTV.SCHEME ACCENT_SCHEME,
    ACCENTV.LEVEL_1,
    ACCENTV.LEVEL_2,
    ACCENTV.ACNT_UNIT,
    a.last_nav*(1-b.pur_load)                   AS buy_nav_value,
    a.last_nav*(1+b.sale_load)                  AS sell_nav_value,
    DECODE(b.scheme_type, 'O', 'OPEN', 'CLOSE') AS portfolio_type,
    B.port_type                                 AS portfolio_category
  FROM --SYSPARAM,   --commented for testing
    HI_WEEKNAV_CURR A,
    HM_SCHEME B ,
    HM_SCHCLASS C,
    (SELECT ACCENT.SCHEME,
      ACCENT.LEVEL_1,
      ACCENT.EXCH_RATE,
      ACCENT.LEVEL_2,
      ACCENT.BOOK_DATE,
      SUM(ACCENT.AMOUNT) ACNT_UNIT
      --(SUM(ACCENT.AMOUNT)/SCHEME.FACE_VALUE) ACNT_UNIT --COMMENTED FOR TESTING
    FROM HI_ACCENT_LIVE ACCENT, -- HI_ACCENT_CURR ACCENT, COMMMENTED FOR TESTING
      HM_SCHEME SCHEME,
      HM_SCHCLASS SCHCLASS
    WHERE ACCENT.SCHEME = SCHEME.SCHEME
    AND SCHEME.SCHEME   = SCHCLASS.SCHEME
      -- AND ACCENT.BOOK_DATE < = '26 Nov 2013' ---inserted for testing
    AND ACCENT.LEVEL_1   = '310100'
    AND ACCENT.LEVEL_2   = SCHCLASS.SCHCLASS
    AND SCHEME.RECTYPE   = 'L'
    AND SCHCLASS.FF_VC1 IS NOT NULL
    AND SCHEME.SCHEME   IN
      (SELECT SCHEME
      FROM HM_SCHEME
      WHERE RECTYPE   = 'L'
      AND NXT_NAV_DT  < '31 MAR 2014'
      AND ACTIVATE_Y_N='Y'
      )
    GROUP BY ACCENT.SCHEME,
      ACCENT.EXCH_RATE,
      ACCENT.LEVEL_1,
      ACCENT.LEVEL_2,
      SCHEME.FACE_VALUE ,
      ACCENT.BOOK_DATE
    ) ACCENTV,
    (SELECT ACCENT.SCHEME,
      SCHCLASS.FF_VC1,
      SUM((LAST_NAV) * (ACCENT.AMOUNT)) SUM_GROUP_NAV,
      SUM(ACCENT.AMOUNT) GROUP_ACNT_UNIT,
      --ROUND( (SUM(LAST_NET_ASSETS) / SUM(ACCENT.AMOUNT)),9) GROUP_NAV
      ACCENT.EXCH_RATE GROUP_NAV,
      SCHCLASS.SCHCLASS -- Added by Ram since the values are getting repeated in MCY report on 08 May 2014
      --(SUM(ACCENT.AMOUNT)/SCHEME.FACE_VALUE) ACNT_UNIT --COMMENTED FOR TESTING
    FROM HI_ACCENT_LIVE ACCENT, -- HI_ACCENT_CURR ACCENT, COMMMENTED FOR TESTING
      HI_WEEKNAV_CURR NAV_CURR,
      HM_SCHEME SCHEME,
      HM_SCHCLASS SCHCLASS
    WHERE ACCENT.SCHEME    = SCHEME.SCHEME
    AND NAV_CURR.SCHCLASS <> 'GLOBAL'
    AND SCHEME.SCHEME      = SCHCLASS.SCHEME
    AND NAV_CURR.SCHEME    = ACCENT.SCHEME
      -- AND ACCENT.BOOK_DATE < = '26 Nov 2013' ---inserted for testing
    AND ACCENT.LEVEL_1    = '310100'
    AND SCHEME.RECTYPE    = 'L'
    AND ACCENT.LEVEL_2    = SCHCLASS.SCHCLASS
    AND NAV_CURR.SCHCLASS = SCHCLASS.SCHCLASS
    AND SCHCLASS.FF_VC1  IS NOT NULL
      --AND  NAV_CURR.WEEKEND_DT    = '25 Nov 2013'
    AND SCHEME.SCHEME IN
      (SELECT SCHEME
      FROM HM_SCHEME
      WHERE RECTYPE   = 'L'
      AND NXT_NAV_DT  < '31 MAR 2014'
      AND ACTIVATE_Y_N='Y'
      )
    GROUP BY ACCENT.SCHEME,
      SCHCLASS.FF_VC1,
      ACCENT.EXCH_RATE,
      SCHCLASS.SCHCLASS -- Added by Ram since the values are getting repeated in MCY report on 08 May 2014
    ) Group_NAV
  WHERE A.SCHCLASS   <> 'GLOBAL'
  AND GROUP_NAV.SCHEME= A.SCHEME
  and GROUP_NAV.SCHCLASS= A.SCHCLASS -- Added by Ram since the values are getting repeated in MCY report on 08 May 2014
  AND GROUP_NAV.FF_VC1= C.FF_VC1
  AND A.SCHCLASS      = C.SCHCLASS
  AND A.SCHEME        = C.SCHEME
  AND A.AMC_CODE      = C.AMC_CODE
  AND C.RECTYPE       ='L'
  AND ACCENTV.SCHEME  = A.SCHEME
  AND ACCENTV.LEVEL_2 = A.SCHCLASS
  AND A.SCHEME        = B.SCHEME
  AND C.FF_VC1       IS NOT NULL
    -- and a.scheme ='HDFCLI'
  AND B.ACTIVATE_Y_N = 'Y'
  AND B.RECTYPE      = 'L'
    -- AND (SYSPARAM.RECTYPE='L')
    --AND (A.WEEKEND_DT    = '25 Nov 2013')--SYSPARAM.CUR_DATE-1) commented for testing
  ORDER BY 1;
 
