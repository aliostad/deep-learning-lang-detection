DROP TABLE IF EXISTS `iseq_product_metrics`;
CREATE TABLE `iseq_product_metrics` (
  `id_iseq_pr_metrics_tmp` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Internal to this database id, value can change',
  `id_iseq_flowcell_tmp` int(10) unsigned DEFAULT NULL COMMENT 'Flowcell id, see "iseq_flowcell.id_iseq_flowcell_tmp"',
  `id_run` int(10) unsigned NOT NULL COMMENT 'NPG run identifier',
  `position` smallint(2) unsigned NOT NULL COMMENT 'Flowcell lane number',
  `tag_index` smallint(5) unsigned DEFAULT NULL COMMENT 'Tag index, NULL if lane is not a pool',
  `tag_sequence4deplexing` varchar(30) DEFAULT NULL COMMENT 'Tag sequence used for deplexing the lane, common suffix might have been truncated',
  `actual_forward_read_length` smallint(4) unsigned DEFAULT NULL COMMENT 'Actual forward read length, bp',
  `actual_reverse_read_length` smallint(4) unsigned DEFAULT NULL COMMENT 'Actual reverse read length, bp',
  `indexing_read_length` smallint(2) unsigned DEFAULT NULL COMMENT 'Indexing read length, bp',
  `tag_decode_percent` float(5,2) unsigned DEFAULT NULL,
  `tag_decode_count` int(10) unsigned DEFAULT NULL,
  `insert_size_quartile1` smallint(5) unsigned DEFAULT NULL,
  `insert_size_quartile3` smallint(5) unsigned DEFAULT NULL,
  `insert_size_median` smallint(5) unsigned DEFAULT NULL,
  `gc_percent_forward_read` float(5,2) unsigned DEFAULT NULL,
  `gc_percent_reverse_read` float(5,2) unsigned DEFAULT NULL,
  `sequence_mismatch_percent_forward_read` float(4,2) unsigned DEFAULT NULL,
  `sequence_mismatch_percent_reverse_read` float(4,2) unsigned DEFAULT NULL,
  `adapters_percent_forward_read` float(5,2) unsigned DEFAULT NULL,
  `adapters_percent_reverse_read` float(5,2) unsigned DEFAULT NULL,
  `ref_match1_name` varchar(100) DEFAULT NULL,
  `ref_match1_percent` float(5,2) DEFAULT NULL,
  `ref_match2_name` varchar(100) DEFAULT NULL,
  `ref_match2_percent` float(5,2) DEFAULT NULL,
  `q20_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q20_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `q30_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q30_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `q40_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q40_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `num_reads` bigint(20) unsigned DEFAULT NULL,
  `percent_mapped` float(5,2) DEFAULT NULL,
  `percent_duplicate` float(5,2) DEFAULT NULL,
  `human_percent_mapped` float(5,2) DEFAULT NULL,
  `human_percent_duplicate` float(5,2) DEFAULT NULL,
  `genotype_sample_name_match` varchar(8) DEFAULT NULL,
  `genotype_sample_name_relaxed_match` varchar(8) DEFAULT NULL,
  `genotype_mean_depth` float(7,2) DEFAULT NULL,
  `mean_bait_coverage` float(6,2) unsigned DEFAULT NULL,
  `on_bait_percent` float(5,2) unsigned DEFAULT NULL,
  `on_or_near_bait_percent` float(5,2) unsigned DEFAULT NULL,
  `verify_bam_id_average_depth` smallint(5) unsigned DEFAULT NULL,
  `verify_bam_id_score` float(7,6) unsigned DEFAULT NULL,
  PRIMARY KEY (`id_iseq_pr_metrics_tmp`),
  KEY `iseq_pm_run_index` (`id_run`),
  KEY `iseq_pm_run_pos_index` (`id_run`,`position`),
  KEY `iseq_pm_fcid_run_pos_tag_index` (`id_run`,`position`,`tag_index`),
  KEY `iseq_pr_metrics_flc_fk` (`id_iseq_flowcell_tmp`),
  KEY `iseq_pr_metrics_lm_fk` (`id_run`, `position`),
  CONSTRAINT `iseq_pr_metrics_flc_fk` FOREIGN KEY (`id_iseq_flowcell_tmp`) REFERENCES `iseq_flowcell` (`id_iseq_flowcell_tmp`) ON DELETE SET NULL ON UPDATE NO ACTION,
  CONSTRAINT `iseq_pr_metrics_lm_fk` FOREIGN KEY (`id_run`, `position`) REFERENCES `iseq_run_lane_metrics` (`id_run`, `position`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `iseq_run_lane_metrics`;
CREATE TABLE `iseq_run_lane_metrics` (
  `id_iseq_flowcell_tmp` int(10) unsigned DEFAULT NULL COMMENT 'Flowcell id, see "iseq_flowcell.id_iseq_flowcell_tmp"',
  `flowcell_barcode` varchar(15) DEFAULT NULL COMMENT 'Manufacturer flowcell barcode or other identifier as recorded by NPG',
  `id_run` int(10) unsigned NOT NULL COMMENT 'NPG run identifier',
  `position` smallint(2) unsigned NOT NULL COMMENT 'Flowcell lane number',
  `instrument_name` char(32) DEFAULT NULL,
  `instrument_model` char(64) DEFAULT NULL,
  `paired_read` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `indexing_read_length` smallint(2) unsigned DEFAULT NULL COMMENT 'Actual reverse read length, bp',
  `cycles` int(4) unsigned NOT NULL,
  `cancelled` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Boolen flag to indicate whether the run was cancelled',
  `run_pending` datetime DEFAULT NULL COMMENT 'Timestamp of run pending status',
  `run_complete` datetime DEFAULT NULL COMMENT 'Timestamp of run complete status',
  `qc_complete` datetime DEFAULT NULL COMMENT 'Timestamp of qc complete status',
  `pf_cluster_count` bigint(20) unsigned DEFAULT NULL,
  `raw_cluster_count` bigint(20) unsigned DEFAULT NULL,
  `raw_cluster_density` double(12,3) unsigned DEFAULT NULL,
  `pf_cluster_density` double(12,3) unsigned DEFAULT NULL,
  `pf_bases` bigint(20) unsigned DEFAULT NULL,
  `q20_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q20_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `q30_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q30_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `q40_yield_kb_forward_read` int(10) unsigned DEFAULT NULL,
  `q40_yield_kb_reverse_read` int(10) unsigned DEFAULT NULL,
  `tags_decode_percent` float(5,2) unsigned DEFAULT NULL,
  `tags_decode_cv` float(6,2) unsigned DEFAULT NULL,
  `adapters_percent_forward_read` float(5,2) unsigned DEFAULT NULL,
  `adapters_percent_reverse_read` float(5,2) unsigned DEFAULT NULL,
  `insert_size_quartile1` smallint(5) unsigned DEFAULT NULL,
  `insert_size_quartile3` smallint(5) unsigned DEFAULT NULL,
  `insert_size_median` smallint(5) unsigned DEFAULT NULL,
  `ref_match1_name` varchar(100) DEFAULT NULL,
  `ref_match1_percent` float(5,2) DEFAULT NULL,
  `ref_match2_name` varchar(100) DEFAULT NULL,
  `ref_match2_percent` float(5,2) DEFAULT NULL,
  `gc_percent_forward_read` float(5,2) unsigned DEFAULT NULL,
  `gc_percent_reverse_read` float(5,2) unsigned DEFAULT NULL,
  `sequence_mismatch_percent_forward_read` float(4,2) unsigned DEFAULT NULL,
  `sequence_mismatch_percent_reverse_read` float(4,2) unsigned DEFAULT NULL,
  PRIMARY KEY (`id_run`,`position`),
  KEY `iseq_rlmm_id_run_index` (`id_run`),
  KEY `iseq_rlm_cancelled_and_run_pending_index` (`cancelled`,`run_pending`),
  KEY `iseq_rlm_cancelled_and_run_complete_index` (`cancelled`,`run_complete`),
  CONSTRAINT `iseq_rl_metrics_flc_fk` FOREIGN KEY (`id_iseq_flowcell_tmp`) REFERENCES `iseq_flowcell` (`id_iseq_flowcell_tmp`) ON DELETE SET NULL ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `iseq_run_status`;
CREATE TABLE `iseq_run_status` (
  `id_run_status` int(11) unsigned NOT NULL,
  `id_run` int(10) unsigned NOT NULL COMMENT 'NPG run identifier',
  `date` datetime NOT NULL COMMENT 'Status timestamp',
  `id_run_status_dict` int(10) unsigned NOT NULL COMMENT 'Status identifier, see iseq_run_status_dict.id_run_status_dict',
  `iscurrent` tinyint(1) NOT NULL COMMENT 'Boolean flag, 1 is the status is current, 0 otherwise',
  PRIMARY KEY (`id_run_status`),
  KEY `iseq_run_status_rsd_fk` (`id_run_status_dict`),
  CONSTRAINT `iseq_run_status_rsd_fk` FOREIGN KEY (`id_run_status_dict`) REFERENCES `iseq_run_status_dict` (`id_run_status_dict`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `iseq_run_status_dict`;
CREATE TABLE `iseq_run_status_dict` (
  `id_run_status_dict` int(10) unsigned NOT NULL,
  `description` varchar(64) NOT NULL,
  `iscurrent` tinyint(3) unsigned NOT NULL,
  `temporal_index` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`id_run_status_dict`),
  KEY `iseq_run_status_dict_description_index` (`description`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

