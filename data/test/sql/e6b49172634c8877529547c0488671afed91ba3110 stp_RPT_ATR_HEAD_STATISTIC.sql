GO
USE [BHSDB];
GO


CREATE PROCEDURE dbo.stp_RPT_OKC_ATR_HEAD_STATISTIC
		  @DTFROM datetime , 
		  @DTTO datetime, 
		  @ATRUNIT varchar(20)
AS
BEGIN
	PRINT 'BAGTAG STORED PROCEDURE BEGIN';
	DECLARE @DATERANGE INT=1;

	SELECT ISC.*,LOC.LOCATION AS ATRUNIT INTO #ATR_ATRDETAIL_TEMP
	FROM ITEM_SCANNED ISC, LOCATIONS LOC WITH(NOLOCK)
	WHERE ISC.TIME_STAMP BETWEEN @DTFROM AND @DTTO
		AND ISC.LOCATION=LOC.LOCATION_ID AND LOC.LOCATION=@ATRUNIT;

	SELECT	aat.ATRUNIT, 
			COUNT(aat.ID) AS TOTAL_READ,
			SUM(aat.HEAD01) AS READ_HEAD01, CAST(SUM(aat.HEAD01) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ01,
			SUM(aat.HEAD02) AS READ_HEAD02, CAST(SUM(aat.HEAD02) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ02,
			SUM(aat.HEAD03) AS READ_HEAD03, CAST(SUM(aat.HEAD03) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ03 ,
			SUM(aat.HEAD04) AS READ_HEAD04, CAST(SUM(aat.HEAD04) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ04,
			SUM(aat.HEAD05) AS READ_HEAD05, CAST(SUM(aat.HEAD05) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ05,
			SUM(aat.HEAD06) AS READ_HEAD06, CAST(SUM(aat.HEAD06) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ06,
			SUM(aat.HEAD07) AS READ_HEAD07, CAST(SUM(aat.HEAD07) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ07,
			SUM(aat.HEAD08) AS READ_HEAD08, CAST(SUM(aat.HEAD08) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ08,
			SUM(aat.HEAD09) AS READ_HEAD09, CAST(SUM(aat.HEAD09) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ09,
			SUM(aat.HEAD10) AS READ_HEAD10, CAST(SUM(aat.HEAD10) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ10,
			SUM(aat.HEAD11) AS READ_HEAD11, CAST(SUM(aat.HEAD11) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ11,
			SUM(aat.HEAD12) AS READ_HEAD12, CAST(SUM(aat.HEAD12) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ12,
			SUM(aat.HEAD13) AS READ_HEAD13, CAST(SUM(aat.HEAD13) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ13,
			SUM(aat.HEAD14) AS READ_HEAD14, CAST(SUM(aat.HEAD14) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ14,
			SUM(aat.HEAD15) AS READ_HEAD15, CAST(SUM(aat.HEAD15) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ15,
			SUM(aat.HEAD16) AS READ_HEAD16, CAST(SUM(aat.HEAD16) AS FLOAT)/CAST(COUNT(aat.ID) AS FLOAT) AS RATE_READ16
	FROM #ATR_ATRDETAIL_TEMP aat
	GROUP BY aat.ATRUNIT;


END

--DECLARE @DTFROM datetime='2013-12-29'; 
--DECLARE @DTTO datetime='2013-12-31';
--DECLARE @ATRUNIT varchar(20)='SS1-2';
--EXEC stp_RPT12_ATR_HEAD_STATISTIC_GWYTEST @DTFROM,@DTTO,@ATRUNIT;