
DROP TRIGGER IF EXISTS INPUT_IN_MONEY;

USE DELIMITER $$
CREATE TRIGGER INPUT_IN_MONEY
AFTER INSERT ON `PRODUCT_ORDER`
FOR EACH ROW BEGIN
	SELECT PRICE AS PRODUCT_PRICE INTO @PRODUCT_PRICE FROM PRODUCT WHERE `PRODUCT`.`PRODUCT_ID` = NEW.PRODUCT_ID;
	
    INSERT INTO MONEY(`AMOUNT`, `AMOUNT_RECEIVED`, `DATE`, `SCOUT_ID`)
    VALUES (NEW.QUANTITY * @PRODUCT_PRICE, 0.00, NOW(), NEW.SCOUT_ID);
    
    INSERT INTO SHIPMENT (`DATE`, `SCOUT_ID`,`RECEIVED`, `ORDER_ID`)
    VALUES (NOW(),NEW.SCOUT_ID,0, NEW.ORDER_ID);
    
    SELECT TROOP_ID AS SCOUT_TROOP INTO @SCOUT_TROOP FROM SCOUT WHERE `SCOUT`.`SCOUT_ID` = NEW.SCOUT_ID;
    
    SELECT SHIPMENT_ID AS GET_SHIPMENT_ID INTO @GET_SHIPMENT_ID FROM SHIPMENT WHERE `SHIPMENT`.`SCOUT_ID` = NEW.SCOUT_ID AND `SHIPMENT`.`DATE` = NEW.DATE AND `SHIPMENT`.`ORDER_ID` = NEW.ORDER_ID;
    
    INSERT INTO INVENTORY (`QUANTITY`, `PRODUCT_ID`,`TROOP_ID`,`SHIPMENT_ID`)
    VALUES (NEW.QUANTITY,NEW.PRODUCT_ID,@SCOUT_TROOP,@GET_SHIPMENT_ID);
    
END;